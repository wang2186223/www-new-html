# 🎯 单仓库GitHub限制解决方案

## 💡 核心策略：选择性文件管理

保持现有67本小说的HTML链接完全不变，但对新增小说采用优化策略。

### 🔍 问题分析

当前仓库大小问题：
- **总大小**: 1.8GB
- **主要占用**: docs/novels (1.6GB)
- **文件数量**: 14,529个HTML文件
- **大文件**: novels-index.json (96MB), novels-cache.json (96MB)

### ✅ 解决方案：分层存储策略

#### 1. 现有小说（67本）
- **保持不变**: 继续存储在仓库中
- **链接不变**: 所有现有URL完全保持
- **SEO保护**: 搜索引擎收录不受影响

#### 2. 新增小说（第68本开始）
- **轻量化存储**: 只保存源文件，不保存生成的HTML
- **动态生成**: 通过GitHub Pages动态构建
- **新域名策略**: 使用子域名或路径前缀区分

## 🛠️ 实施方案

### 方案A：混合存储模式

```bash
# 现有小说结构（保持不变）
docs/novels/
├── sightless-redemption/        # 第1-67本，保持HTML文件
├── crimson-vendettas/
└── ...

# 新增小说结构（轻量化）
source/
├── Novel-68/                    # 只保存源文件
└── Novel-69/
```

### 方案B：压缩存储模式

```bash
# 将现有小说HTML文件压缩存储
docs/
├── novels-archive.zip          # 压缩的现有小说HTML
├── novels-new/                 # 新增小说的HTML
└── index.html                  # 主页
```

### 方案C：分支存储模式

```bash
# 主分支：轻量级
main: source/ + tools/ + 配置文件

# 部署分支：完整网站
gh-pages: 完整的docs文件夹
```

## 🎯 推荐方案：智能构建模式

### 核心思路
1. **保留现有**: 67本小说的HTML文件继续存储
2. **优化新增**: 新小说采用即时构建策略
3. **减小文件**: 压缩大型JSON文件
4. **智能推送**: 只推送变化的文件

### 实施步骤

#### 1. 修改构建脚本
```python
# 新增小说检测
if novel_count > 67:
    # 使用轻量化策略
    generate_minimal_files()
else:
    # 保持原有策略
    generate_full_files()
```

#### 2. 文件大小优化
- 压缩 novels-index.json (96MB → ~20MB)
- 分割 novels-cache.json 
- 启用Git LFS管理大文件

#### 3. 选择性同步
```bash
# 只推送变化的文件
git add source/           # 源文件
git add docs/index.html   # 主页
git add docs/sitemap.xml  # 站点地图
# 跳过未变化的novels文件夹
```

## 📝 具体实现

### 1. 优化JSON文件大小
```python
# 压缩novels-index.json
import gzip
import json

def compress_index():
    with open('docs/novels-index.json', 'r') as f:
        data = json.load(f)
    
    # 移除冗余数据，只保留必要信息
    minimal_data = {
        'novels': [{
            'title': n['title'],
            'slug': n['slug'],
            'chapters': len(n['chapters'])
        } for n in data['novels']]
    }
    
    with open('docs/novels-index-minimal.json', 'w') as f:
        json.dump(minimal_data, f, separators=(',', ':'))
```

### 2. 新增智能推送脚本
```bash
#!/bin/bash
# tools/smart-push.sh

echo "🔍 检测文件变化..."
CHANGED_FILES=$(git diff --name-only HEAD~1)

if echo "$CHANGED_FILES" | grep -q "source/"; then
    echo "📝 检测到源文件变化，构建网站..."
    python3 tools/build-website.py
    
    echo "📦 智能推送变化的文件..."
    git add source/
    git add docs/index.html
    git add docs/sitemap.xml
    
    # 只推送新增小说的HTML
    git add docs/novels/*/index.html
    
    git commit -m "更新: $(date '+%Y-%m-%d %H:%M')"
    git push origin main
else
    echo "ℹ️ 无需构建，直接推送..."
    git push origin main
fi
```

### 3. 修改.gitignore优化
```gitignore
# 临时忽略大文件，手动选择推送
docs/novels-cache.json
docs/covers/*.png
docs/novels/*/chapter-*.html

# 只保留必要文件
!docs/novels/*/index.html
!docs/index.html
!docs/sitemap.xml
```

## 🎊 预期效果

### 仓库大小优化
- **从**: 1.8GB → **到**: ~500MB
- **现有链接**: 100%保持不变
- **新增小说**: 轻量化处理
- **推送速度**: 提升80%

### 链接兼容性
```
现有小说 (1-67本):
✅ https://my.newreadnovel.com/novels/sightless-redemption/
✅ https://my.newreadnovel.com/novels/crimson-vendettas/
...

新增小说 (68本+):
🆕 https://my.newreadnovel.com/new/novels/novel-68/
🆕 动态构建，即时访问
```

## 🚀 立即可用的临时方案

在实施完整方案前，可以先使用：

```bash
# 1. 压缩现有大文件
gzip docs/novels-cache.json
gzip docs/novels-index.json

# 2. 临时移除chapters文件夹
mv docs/novels/*/chapter-*.html /tmp/chapters-backup/

# 3. 推送精简版本
git add . && git commit -m "临时精简推送" && git push

# 4. 恢复文件
mv /tmp/chapters-backup/* docs/novels/*/
```

**这个方案既解决了GitHub限制，又保持了所有现有功能！**